$(document).ready(function(){
 
/** 左侧导航响应 **/
	$(".user-main .main-left ul a#li_1").click(function(){
		$("div#rightcontent1").removeClass("xiaoshi");
		$("div#rightcontent2").addClass("xiaoshi");
		$("div#rightcontent3").addClass("xiaoshi");
		$("div#rightcontent4").addClass("xiaoshi");
		$("div#rightcontent5").addClass("xiaoshi");
		$(".user-main .main-left ul li a").removeClass("a_active");
		$("a#li_1").addClass("a_active");
	});
	
	$(".user-main .main-left ul a#li_2").click(function(){
		$("div#rightcontent2").removeClass("xiaoshi");
		$("div#rightcontent1").addClass("xiaoshi");
		$("div#rightcontent3").addClass("xiaoshi");
		$("div#rightcontent4").addClass("xiaoshi");
		$("div#rightcontent5").addClass("xiaoshi");
		$(".user-main .main-left ul li a").removeClass("a_active");
		$("a#li_2").addClass("a_active");
	});

	$(".user-main .main-left ul a#li_3").click(function(){
		$("div#rightcontent3").removeClass("xiaoshi");
		$("div#rightcontent1").addClass("xiaoshi");
		$("div#rightcontent2").addClass("xiaoshi");
		$("div#rightcontent4").addClass("xiaoshi");
		$("div#rightcontent5").addClass("xiaoshi");
		$(".user-main .main-left ul li a").removeClass("a_active");
		$("a#li_3").addClass("a_active");
	 
	});
	
	$(".user-main .main-left ul a#li_4").click(function(){
		$("div#rightcontent4").removeClass("xiaoshi");
		$("div#rightcontent1").addClass("xiaoshi");
		$("div#rightcontent2").addClass("xiaoshi");
		$("div#rightcontent3").addClass("xiaoshi");
		$("div#rightcontent5").addClass("xiaoshi");
		$(".user-main .main-left ul li a").removeClass("a_active");
		$("a#li_4").addClass("a_active");
 
	});

		$(".user-main .main-left ul a#li_5").click(function(){
		$("div#rightcontent5").removeClass("xiaoshi");
		$("div#rightcontent1").addClass("xiaoshi");
		$("div#rightcontent2").addClass("xiaoshi");
		$("div#rightcontent3").addClass("xiaoshi");
		$("div#rightcontent4").addClass("xiaoshi");
		$(".user-main .main-left ul li a").removeClass("a_active");
		$("a#li_5").addClass("a_active");
	 
	});

		$(".user-main .main-left ul a#li_6").click(function(){
		$("div#rightcontent6").removeClass("xiaoshi");
		$("div#rightcontent1").addClass("xiaoshi");
		$("div#rightcontent2").addClass("xiaoshi");
		$("div#rightcontent3").addClass("xiaoshi");
		$("div#rightcontent4").addClass("xiaoshi");
		$(".user-main .main-left ul li a").removeClass("a_active");
		$("a#li_6").addClass("a_active");
	 
	});

		$(".user-main .main-left ul a#li_7").click(function(){
		$("div#Fyfabu").addClass("xiaoshi");
		$("div#resetPwddom").addClass("xiaoshi");
		$("div#first-page").addClass("xiaoshi");
		$("div#myFabu").addClass("xiaoshi");
		$("div#personal_info").removeClass("xiaoshi");
		$(".user-main .main-left ul li a").removeClass("a_active");
		$("a#li_7").addClass("a_active");
	 
	});

 /**当搜索框为空回复全部列表**/
	$("div.hasList").click(function(){
			if(($("input#table_search").val())==""||($("input#table_search").val())==" "){
	  		$("table tbody tr").show();
	  	}
	 });
	  
	 
	/**表格搜索**/
		
     $('#search-bt').click(function(){
        var sstxt=$('#table_search').val();
        $("table tbody tr")
              .hide()
              .filter(":contains('"+sstxt+"')")
              .show();
   		  
       return false;
 	 });

 	  


 	  /**unfinished**/
 

 	 /** **/ 
 	 $("a#logout").click(function(){
 	 	if(confirm("确定退出吗？")){
 	 		location.href="login.html";
 	 	}
 	 	else{
 	 		return false;
 	 	}
 	 });


 	 /** 修改名字 **/
 	 $("a.nameSubmit").click(function(){
 	 	var new_name = $("input.nickName").val();
 	 	$("div.user-name").text("欢迎你,"+new_name);
 	 	$("#welcome_username").text(new_name);
 	 });
 	 var objUrl;
 	 /** upload pic **/
 	 $("#file0").change(function(){
	 objUrl = getObjectURL(this.files[0]) ;
	console.log("objUrl = "+objUrl) ;
	if (objUrl) {
		$("#img0").attr("src", objUrl) ;
	}
	});
	//建立一個可存取到該file的url
	function getObjectURL(file) {
		var url = null ; 
		if (window.createObjectURL!=undefined) { // basic
			url = window.createObjectURL(file) ;
		} else if (window.URL!=undefined) { // mozilla(firefox)
			url = window.URL.createObjectURL(file) ;
		} else if (window.webkitURL!=undefined) { // webkit or chrome
			url = window.webkitURL.createObjectURL(file) ;
		}
		return url ;
	}
	/** change logo of main-left**/
	$("div#updatePortrait span.sucServer").click(function(){
		$(".user-main .main-left .name img").attr("src",objUrl);
	});
 	/** 解决搜索时按分页按钮切换 **/
	 $(".field").change(function(){  
                    if(($("input.field").val())!=""){
                        if((($("input.field").next())[0].tagName)=="BUTTON"){
                         $("input.field").after("<span>123</span>");
                        }
                        else{
                         return false;
                        }
                    }
                      if(($("input.field").val())==""){
                    	if((($("input.field").next())[0].tagName)=="SPAN"){
                         $(".check_wrap .form-group span").remove();
                        }
                    }
               });
	 /** agent 修改密码ajax**/
	 $("#user_pwd .agent_pwd_btn").click(function(){
	 	if(($("input#password1").val())==($("input#password2").val())){
	 		$.post("/agent/modify_password",{'oldPassword':$("input#password").val(), 'newPassword': $("input#password2").val()},function(result) {
	 			alert("agent/pwd");
	 			if(result.code == 200){
	 				alert("密码修改成功");
	 			}
	 			else{
	 				alert("密码修改失败");
	 			}
	 		},'json');
	 	}
	 	else{
	 		alert("请确认两次新密码输入一致");
	 	}
	 });
	 		/** user password reset**/
	 $("#user_pwd .user_pwd_btn").click(function(){
	 	if(($("input#password_1").val())==($("input#password_2").val())){
	 		$.post("/user/modify_password",{'oldPassword':$("input#password").val(), 'newPassword': $("input#password_1").val()},function(result) {
	 			if(result.code == 200){
	 				alert("密码修改成功");
	 			}
	 			else if(result.code == 500){
	 				alert("密码修改失败");
	 			}
	 		},'json');
	 	}
	 	else{
	 		alert("请确认两次新密码输入一致");
	 	}
	 });
	 
	 /** 提交个人信息 **/
	 $("#user_personalInfo .personalInfo_wrap .agent_personalInfo_btn").click(function(){
	 	alert("agent/modify");
	 	$.post('/agent/modify_agent',{'name':$("input#username").val(),'sex':1,
	 		'age':$("input#age").val() == '' ? 0 : $("input#age").val(),'email':$("input#email").val(),
	 		'year':$("input#year").val() == '' ? 0 : $("input#year").val(),
	 		'company':$("input#company").val(),'phone':$("input#phone").val(),
	 		'introduction':$("textarea#selfIntro").val()},function(result){
	 			if(result.code == 200){
	 				alert("个人信息修改成功!");
	 				$(".user-main .main-left .user-name span").text(result.agentEntity.name);
	 				$(".user-main .tab-content #mtab2 span#personalInfo_name ").text(result.agentEntity.name);
	 				$(".user-main .tab-content #mtab2 span#personalInfo_sex ").text(result.agentEntity.sex);
	 				$(".user-main .tab-content #mtab2 span#personalInfo_age").text(result.agentEntity.age);
	 				$(".user-main .tab-content #mtab2 span#personalInfo_phone ").text(result.agentEntity.phone);
	 				$(".user-main .tab-content #mtab2 span#personalInfo_email ").text(result.agentEntity.email);
	 				$(".user-main .tab-content #mtab2 span#personalInfo_year ").text(result.agentEntity.year);
	 				$(".user-main .tab-content #mtab2 span#personalInfo_company ").text(result.agentEntity.company);	
	 				$(".user-main .tab-content #mtab2 span#personalInfo_selfIntro ").text(result.agentEntity.selfIntro);
	 			}
	 			else{
	 				alert("个人信息修改失败");
	 			}
	 		},'json');
	 });
		/** user  personalInfo upload**/
	 $("#user_personalInfo .user_personalInfo_wrap .user_personalInfo_btn").click(function(){
	 	$.post('/user/modify_user',{'name':$("input#username").val(),'sex':1,
	 		'age':$("input#age").val() == '' ? 0 : $("input#age").val(),'contact':$("input#phone").val()},function(result){
	 			if(result.code == 200){
	 				alert("个人信息修改成功");
 					$("#user_left_username").text(result.userEntity.name);
	 			 	$("#right_username").text(result.userEntity.name);
	 			 	$(".info_c .user_name").text(result.userEntity.name);
	 			 	$(".info_c .user_sex").text(result.userEntity.sex);
	 			 	$(".info_c .user_age").text(result.userEntity.age);
	 			 	$(".info_c .user_date").text(result.userEntity.timestamp);
	 			 	$(".info_c .user_contact").text(result.userEntity.contact);
	 			}
	 			else{
	 				alert("个人信息修改失败");
	 			}
	 		},'json');
	 });
	 /** 提交房源信息ajax **/
	 $(".tabbable .user-main .tab-content .fy .fabu .lj-btn").click(function(){
	 	$.post('/agent/add_house',{'title':$("input#FyTitle").val(),'houseNumber':$("input#houseNumber").val(),
	 		'villageName':$("input#villageName").val(),'roomAmount':$("input#shi").val() == '' ? 0 : $("input#shi").val(),
	 		'livingroomAmount':$("input#ting").val() == '' ? 0 : $("input#ting").val(),
	 		'toiletAmount':$("input#wei").val() == '' ? 0 : $("input#wei").val(),
	 		'balconyAmount':$("input#yang").val() == '' ? 0 : $("input#yang").val(),
	 		'area':$("input#mianji").val() == '' ? 0 : $("input#mianji").val(),
	 		'year':$("input#FyYear").val() == '' ? 0 : $("input#ting").val(),
	 		'floor':$("input#floor").val() == '' ? 0 : $("input#floor").val(),
	 		'orientation':$("select#orientation").val(),
	 		'prize':$("input#prize").val() == '' ? 0 : $("input#prize").val(),
	 		'downPayment':$("input#downPayment").val() == '' ? 0 : $("input#downPayment").val(),
	 		'monthlyPayment':$("input#monPayment").val() == '' ? 0 : $("input#monthlyPayment").val(),
	 		'houseDescribe':$("textarea#houseDescribe").val(),'province':$("input#province").val(),
	 		'city':$("input#city").val(),'town':$("input#town").val(),
	 		'address':$("input#FyAddress").val(),'state':$("select#state").val()},function(result){
	 		if(result.code==200){
	 			alert("房源发布成功");
	 		}else{
	 			alert("房源发布失败");
	 		}
	 	},'json');
	 });
	
	

});
/** 我的发布列表刷新 **/
$(function(){

    var cur_totalpage=9999;
    //分页
    var fetchConfigData = function (curr) {

        $.post('/agent/list_house', {'page': curr}, function (result) {
  
            createTable(result);
            cur_totalpage = result.pageSize;
            //显示分页
            laypage({
                cont: 'page', //分页容器
                pages: cur_totalpage, //总页数
                curr: curr || 1, //当前页
                jump: function (obj, first) { //分页后的回调，点击跳页触发函数自身，并传递当前页：obj.curr
                    //一定要加此判断，否则初始时会无限刷新
                    if (!first) {
                        fetchConfigData(obj.curr);
                    }
                }
            });
        }, 'json');
    };

    //加载表格
    var createTable = function (result) {

    	$("#table_list tbody tr").remove();
    	for(var i = 0 ; i < result.houseListSize;i++){
    		$("#table_list tbody").append("<tr id='" + result.houseList[i].houseId + "'>" +
    									"<td>" + result.houseList[i].houseNumber + "</td>" +
    									"<td>" + result.houseList[i].villageName + "</td>" +
    									"<td>" + result.houseList[i].roomAmount + "室" + result.houseList[i].livingroomAmount + "厅" + 
    											 result.houseList[i].toiletAmount + "卫" + result.houseList[i].balconyAmount + "阳" + "</td>"+
    									"<td>" + result.houseList[i].downPayment + "</td>" +
    									"<td>" + result.houseList[i].prize + "</td>"+
    									"<td>" + "<span class='actionForList' id='" + result.houseList[i].houseId + "'>" + "删除" + "</span>" + "</td>"+

    								"</tr>"
    								)
    	}
    	/** 删除 **/
    	$(".actionForList").click(function(){
    		if(confirm("确定删除吗？")){
 	 		  $.post('/agent/delete_house', {'houseId': $(this).attr("id")}, function(result) {
	    		if (result.code == 200) {
	    			fetchConfigData(1);
	    		} else {
	    			alert('fail');
	    		}
	    	}, 'json');
 	 		}
 	 		else{
 	 			return false;
 	 		}
	    
	    });

    }

    $("#li_5").click(function(){
    	fetchConfigData(1);	
    });
});

/** user list_interest **/
 $(function(){
 
    var cur_totalpage=9999;
    //分页
    var fetchConfigData = function (curr) {
 
        $.post('/user/list_interest',{'page': curr}, function (result) {
 
            createTable(result);
            cur_totalpage = result.pageSize;
            //显示分页
            laypage({
                cont: 'fol_houseList_page', //分页容器
                pages: cur_totalpage, //总页数
                curr: curr || 1, //当前页
                jump: function (obj, first) { //分页后的回调，点击跳页触发函数自身，并传递当前页：obj.curr
                    //一定要加此判断，否则初始时会无限刷新
                    if (!first) {
                        fetchConfigData(obj.curr);
                    }
                }
            });
        }, 'json');
    };

    //加载表格
    var createTable = function (result) {
    	$("#fol_houstList tbody tr").remove();2
    	for(var i = 0 ; i < result.houseListSize;i++){
    		$("#fol_houstList tbody").append("<tr id='" + result.houseList[i].houseId + "'>" +
    									"<td>" + result.houseList[i].houseNumber + "</td>" +
    									"<td>" + result.houseList[i].villageName + "</td>" +
    									"<td>" + result.houseList[i].roomAmount + "室" + result.houseList[i].livingroomAmount + "厅" + 
    											 result.houseList[i].toiletAmount + "卫" + result.houseList[i].balconyAmount + "阳" + "</td>"+
    									"<td>" + result.houseList[i].downPayment + "</td>" +
    									"<td>" + result.houseList[i].prize + "</td>"+
    									"<td>" + "<span class='actionForList' id='" + result.houseList[i].houseId + "'>" + "删除" + "</span>" + "</td>"+
    								"</tr>"
    								)
    	}
    	/** 删除 **/
    	$(".actionForList").click(function(){
    		if(confirm("确定取消关注吗？")){
 	 		  $.post('/user/delete_interest', {'houseId': $(this).attr("id")}, function(result) {
	    		if (result.code == 200) {
	    			fetchConfigData(1);
	    		} else {
	    			alert('fail');
	    		}
	    	}, 'json');
 	 		}
 	 		else{
 	 			return false;
 	 		}
	    
	    });

    }

    $(".user_folInterestList").click(function(){
 
    	fetchConfigData(1);	
    });
   
});
 
 $(function(){
	$("span.sucServer").click(function(){
		var formData = new FormData($("#upload_form")[0]);
		if (formData == null) {
			alert("No");
		} else {
			alert(formData);
			$.ajax({
				url: '/upload/user_file',
				type: 'post',
				data: formData,
				async: false,
				cache: false,
				contentType: false,
				processData: false,
				dataType: 'json',
				success: function(result) {
					alert("ok");
					if (result.code == 200) {
						$(".main-left .name img").attr("src", result.userEntity.photoUrl);
						$(".info_wrap .logo picturebox img").attr("src", result.userEntity.photoUrl);
					}	
				},
				error: function(result) {
					alert("fail")
				}
			});
		}
		
	});
 });

 $(function(){
//		$("span.sucServer").click(function(){
//			$.post('/upload/file',{'fileName':1,'clientFile':$("#picUploadClientFile").val()},function(result){
//				alert("post");
//				if(result.code == 200){
//					alert("上传成功");
//				}
//				else{
//					alert("上传失败");
//				}
//			},'json');
			
//			var formData = new FormData( document.getElementById("upload_1") );
//			$.ajax({
//				url:'/upload/user_file',
//				type: 'POST',  
//		          data: formData,  
//		          async: false,  
//		          cache: false,  
//		          contentType: false,  
//		          processData: false, 
//				dataType: 'json',
//				success : function(result) {
//					alert("ok");
//				},
//				error : function(result) {
//					alert("fail");
//				}
//			});
//		});

	});





 
